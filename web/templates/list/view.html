{% extends "base.html" %}

{% block css %}
    <style type="text/css">
        #draggablePanelList .panel-heading {
            cursor: move;
        }

        #draggablePanelList {
            height: 300px
        }
    </style>
    <link href="//code.jquery.com/ui/1.10.1/themes/base/jquery-ui.css" type="text/css" rel="stylesheet" media="all">
{% endblock %}

{% block content %}
    <section class="col-sm-9 pane">
        <header>
            <h2>My Wittlist - {{ list.name }}</h2>
        </header>

        <!-- Wittlist -->
        <div class="wittlist row">

            {% for list_item in list.listitem_set.all %}
                <!-- Start card -->
                <div class="col-sm-4 card-wrapper">
                    <div class="card" data-id="{{ list_item.id }}" data-wittl-weight="3">
                        <div class="pic">
                            <a class="favourite pull-right" href="#"><i class="icon_star_alt"></i></a>
                            <img src="{{ list_item.card_image }}" title="Name of thing here"/>
                        </div>

                        <div class="detail">
                            <header class="col-xs-9">
                                <h3 class="title">{{ list_item.name|truncatechars:15 }}</h3>

                                <p class="wittl-meta-description">Ericeira, Portugal</p>
                            </header>
                            <div class="user-metrics col-xs-3">
                                <div class="row">
                                    <span class="col-xs-6 icon_building key"></span>
                                    <small class="col-xs-6 value">25</small>
                                </div>
                                <div class="row">
                                    <span class="col-xs-6 icon_pin_alt key"></span>
                                    <small class="col-xs-6 value">3</small>
                                </div>
                            </div>
                        </div>
                        <!-- End detail -->
                    </div>
                    <!-- End card -->
                </div>
                <!-- End card-wrapper -->
            {% endfor %}

        </div>

        <div>
            <form method="POST" action="{% url 'insert_list_item' list.id %}">
                {% csrf_token %}
                <div class="input-group">
                    <input type="text" name="urlt" class="form-control" placeholder="Add a new item to your Wittlist"/>
              <span class="input-group-btn">
                <button type="button" class="btn wittl-btn">Insert</button>
              </span>
                </div>
            </form>
        </div>
        <!-- End wittlist -->
    </section>


    <section class="col-sm-3 pane">
        <header>
            <h2>Wittls</h2>
        </header>

        <div class="query-wrapper">
            <div class="input-group">
                <input type="text" name="query-input" class="form-control" placeholder="Add a new Wittl here..."/>
              <span class="input-group-btn">
                <button type="button" class="btn wittl-btn">WITTL</button>
              </span>
            </div>
        </div>

        <div class="wittl-wrapper" id="wittl-wrapper">
            {#            <ul class="wittls" id="wittl-list">#}
            {##}
            {#                                {% for comparator in comparators %}#}
            {#                                    {% include 'list/comparator.html' with comparator=comparator %}#}
            {#                                {% endfor %}#}
            {#            </ul>#}
        </div>

    </section>

{% endblock %}

{% block javascript %}
    <script type="text/javascript" src="//code.jquery.com/ui/1.10.1/jquery-ui.js"></script>
    <script type="text/javascript">
        var scoringUrl = "{% url "get_scores" list.id %}";
    </script>
    <script src='http://cdn.ractivejs.org/latest/ractive.js'></script>
    <script src="/static/web/js/wittl_list.js"></script>

    <script>
        $.get("/static/web/js/test.tmpl").done(function (data) {
            var ractive = new Ractive({
                el: 'wittl-wrapper',

                // We could pass in a string, but for the sake of convenience
                // we're passing the ID of the <script> tag above.
                template: data,

                // Here, we're passing in some initial data
                data: { name: 'world', wittls: [
                    {name: "a", primary_param:"London"},
                    {name: "b"},
                    {name: "c"}
                ] },
                complete: function () {
                    initializeSorting({"1": {"travel_prices_from": 90, "travel_time_from": 420}, "2": {"travel_prices_from": 152, "travel_time_from": 368}});
                }
            });
        });

    </script>

    <script>
        $(function () {

            $(".comparator_form")
                    .on("change", ":input", function () {
                        var formData = $(this).parent("form").serializeArray();
                        var serializedForm = {};
                        $.each(formData, function (i, field) {
                            serializedForm[field["name"]] = field["value"];
                        });

                        var comparatorID = serializedForm["comparator_id"];
                        delete serializedForm["comparator_id"];

                        $.post("{% url "save_comparator_settings" %}",
                                {"comparator_id": comparatorID, "configuration": JSON.stringify(serializedForm)}
                        )
                    });
        });

    </script>

{% endblock %}